<!doctype js>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì¹´í˜ ì‹œë®¬ë ˆì´í„°â˜•ï¸(v.0.0.1)</title>
  <style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ - í…ìŠ¤íŠ¸ ì¤‘ì‹¬ UI */
    :root{--bg:#fafafa;--card:#fff;--accent:#333}
    body{font-family:system-ui,-apple-system,\"Noto Sans KR\",sans-serif;background:var(--bg);color:var(--accent);margin:0;padding:24px}
    h1{margin:0 0 12px}
    .screen{max-width:780px;margin:0 auto;background:var(--card);padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .menu-list{list-style:none;padding:0;margin:12px 0}
    .menu-list li{margin:8px 0}
    button{padding:8px 12px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .small{font-size:13px;padding:6px 10px}
    .row{display:flex;gap:12px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}

    /* ë ˆì‹œí”¼ë¶ íŒì—… */
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);}
    .popup{background:#fff;padding:16px;border-radius:8px;max-width:640px;width:90%;max-height:80vh;overflow:auto}
    .popup h3{margin:0 0 8px}
    .close{float:right;border:0;background:transparent;font-weight:700}

    /* ê²Œì„ í™”ë©´ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .slots{display:flex;gap:8px;margin:14px 0}
    .slot{min-width:140px;padding:10px;border:2px dashed #ccc;border-radius:6px;text-align:left}
    .ingredients{display:flex;flex-direction:column;gap:8px}
    .ingredient{padding:10px;border-radius:6px;border:1px solid #e0e0e0}
    .disabled{opacity:0.5}
    .hidden{display:none}
    .status{margin-top:8px}
    pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="screen" id="app">
    <h1>ì¹´í˜ ì‹œë®¬ë ˆì´í„°â˜•ï¸(v.0.0.1)</h1>

    <!-- HOME VIEW -->
    <div id="homeView">
      <ol class="menu-list">
        <li><button id="startBtn">1) ê²Œì„ ì‹œì‘</button></li>
        <li><button id="openBookBtn">2) ë ˆì‹œí”¼ë¶</button></li>
        <li><button id="optionsBtn">3) ì˜µì…˜</button></li>
        <li><button id="quitBtn">4) ì¢…ë£Œ</button></li>
        <li><button id="rankingBtn">5) ë­í‚¹ ë³´ê¸°</button></li>
      </ol>

      <div class="row">
        <div>ìµœê³  ì ìˆ˜: <span id="bestScore">0</span></div>
        <div>ëª¨ë“œ: <span id="currentMode">ëª¨ë“  ë©”ë‰´</span></div>
      </div>
    </div>

    <!-- OPTIONS VIEW -->
    <div id="optionsView" class="hidden">
      <h2>ì˜µì…˜</h2>
      <div class="col">
        <label>íƒ€ì´ë¨¸ ì„¤ì •</label>
        <div class="row">
          <button class="small" data-t=10>ì´ˆê¸‰ 10ì´ˆ</button>
          <button class="small" data-t=8>ì¤‘ê¸‰ 8ì´ˆ</button>
          <button class="small" data-t=5>ê³ ê¸‰ 5ì´ˆ</button>
        </div>

        <label>ì¶œì œ í•„í„°</label>
        <div class="row">
          <button class="small" id="filterAll">ëª¨ë“  ë©”ë‰´</button>
          <button class="small" id="filterHot">Hotë§Œ</button>
          <button class="small" id="filterIce">Iceë§Œ</button>
        </div>

        <div class="row">
          <button id="backFromOptions" class="small">ë’¤ë¡œê°€ê¸°</button>
        </div>
      </div>
    </div>

    <!-- GAME VIEW -->
    <div id="gameView" class="hidden">
      <div class="meta">
        <div><strong id="menuTitle">ë©”ë‰´ëª…</strong> (<span id="menuTemp">Hot</span>)</div>
        <div>ì‹œê°„: <span id="timer">10</span>s</div>
      </div>

      <div>ì ìˆ˜: <span id="score">0</span> | ì½¤ë³´: <span id="combo">0</span></div>

      <div class="slots" id="slots"></div>

      <div>
        <div class="ingredients" id="ingredients"></div>
      </div>

      <div class="status" id="status"></div>

      <div class="row" style="margin-top:12px;">
        <button id="giveUpBtn">í¬ê¸°</button>
        <button id="nextBtn" class="hidden">ë‹¤ìŒ ë¬¸ì œ</button>
      </div>

      <div class="meta">
        <div>
            ë‚¨ì€ ê²Œì„ ì‹œê°„: <span id="totalTimer">02:00</span>
        </div>
    </div>

  <!-- RESULT VIEW (ê°„ë‹¨) -->
  <div id="resultView" class="hidden">
  <h2 id="resultText">ê²°ê³¼</h2>
  <div id="rankingList" style="margin-top:20px;"></div>
  <div>íšë“ ì ìˆ˜: <span id="lastScore">0</span>
  </div>
  
  <!-- RANKING VIEW -->
  <div id="rankingView" class="hidden">
    <h2>ğŸ† TOP 10 ë­í‚¹</h2>
    <div id="rankingContent" style="margin-top:16px;"></div>
    <button id="rankingBackBtn" style="margin-top:16px;">ë’¤ë¡œê°€ê¸°</button>
  </div>

  <!-- ğŸ”¥ ë‹‰ë„¤ì„ ì…ë ¥ + ì ìˆ˜ ì €ì¥ ë²„íŠ¼ ì¶”ê°€ -->
  <div style="margin-top:10px;">
    <input id="usernameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" style="padding:6px; border:1px solid #ccc; border-radius:4px;" />
    <button id="saveScoreBtn" class="small">ì ìˆ˜ ì €ì¥</button>
  </div>

  <div style="margin-top:10px;">
    <button id="backHome">í™ˆìœ¼ë¡œ</button>
  </div>
</div>

  <!-- ë ˆì‹œí”¼ë¶ íŒì—… (í…ìŠ¤íŠ¸ íŒì—…) -->
  <div id="recipePopup" class="overlay hidden">
    <div class="popup">
      <button class="close" id="closeBook">X</button>
      <h3>ë ˆì‹œí”¼ë¶</h3>
      <pre id="recipeContent">loading...</pre>
    </div>
  </div>
  
<!-- recipes.jsë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸° -->
<script src="recipes.js"></script>
<!-- ê²Œì„ ë¡œì§ ë¶ˆëŸ¬ì˜¤ê¸° -->
<script src="somesome.js"></script>

<script type="module">
  // Firebase SDK ê°€ì ¸ì˜¤ê¸°
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // â­ ë„ˆì˜ firebase ì„¤ì • ë¶™ì—¬ë„£ê¸°
  const firebaseConfig = {
    apiKey: "AIzaSyD6MCzGTSI4ECLqg7FjKOKwsL-rLNH5YAg",
    authDomain: "somesome-b9a49.firebaseapp.com",
    projectId: "somesome-b9a49",
    storageBucket: "somesome-b9a49.firebasestorage.app",
    messagingSenderId: "237879091690",
    appId: "1:237879091690:web:5e1b5ea6908904f978d293",
    measurementId: "G-4QN3DYJJFB"
  };
  
   // Firebase ì´ˆê¸°í™”
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ì ìˆ˜ ì €ì¥(ì´ë¦„ + ì ìˆ˜)
  async function saveScore(name, score) {
    await addDoc(collection(db, "scores"), {
      name: name,
      score: score,
      timestamp: Date.now()
    });
  }

  // TOP 10 ì¡°íšŒ
  async function getTop10Scores() {
    const q = query(
      collection(db, "scores"),
      orderBy("score", "desc"),
      limit(10)
    );

    const snapshot = await getDocs(q);
    let results = [];
    snapshot.forEach(doc => {
      results.push(doc.data());
    });
    return results;
  }

  // ì „ì—­ì—ì„œ ì“°ê¸° ì‰½ê²Œ windowì— ë¶™ì—¬ì£¼ê¸°
  window.saveScore = saveScore;
  window.getTop10Scores = getTop10Scores;
</script>